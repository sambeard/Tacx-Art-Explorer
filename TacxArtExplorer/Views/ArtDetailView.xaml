<UserControl
    x:Class="TacxArtExplorer.Views.ArtDetailView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:converters="clr-namespace:TacxArtExplorer.Views.Converters"
    mc:Ignorable="d">

    <UserControl.Resources>
        <!-- Your converter (as you noted) -->
        <converters:BasicHtmlToFlowDocumentConverter x:Key="BasicHtmlToFlowDoc"/>

        <!-- Top hover header: dark -> transparent -->
        <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#D0151515" Offset="0.0"/>
            <GradientStop Color="#80151515" Offset="0.6"/>
            <GradientStop Color="#00151515" Offset="1.0"/>
        </LinearGradientBrush>

        <!-- Reading overlay: transparent -> dark; we fade its Opacity in code -->
        <LinearGradientBrush x:Key="ReadingOverlayBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#00000000" Offset="0.0"/>
            <GradientStop Color="#99000000" Offset="0.55"/>
            <GradientStop Color="#E6000000" Offset="1.0"/>
        </LinearGradientBrush>
    </UserControl.Resources>

    <Grid Background="Black">
        <!-- BACKGROUND IMAGE (not scrollable) -->
        <Image
            Source="{Binding CurrentImageSource}"
            Stretch="UniformToFill"
            RenderOptions.BitmapScalingMode="HighQuality"
            SnapsToDevicePixels="True"
            Panel.ZIndex="0"/>

        <!-- READING OVERLAY (fades to opaque as you scroll into data) -->
        <Border x:Name="ReadingOverlay"
                Background="{StaticResource ReadingOverlayBrush}"
                Opacity="0"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Panel.ZIndex="1"/>

        <!-- SCROLL: ONLY metadata/description; initial view shows TITLE ONLY -->
        <ScrollViewer x:Name="MainScroll"
                      VerticalScrollBarVisibility="Auto"
                      Background="Transparent"
                      Panel.ZIndex="2"
                      ScrollChanged="MainScroll_ScrollChanged"
                      SizeChanged="MainScroll_SizeChanged">
            <!-- Use a StackPanel so a simple TopSpacer pushes content down -->
            <StackPanel x:Name="MetaStack" Margin="16,12,16,24">
                <!-- Sized in code so offset 0 shows only TitlePanel -->
                <Border x:Name="TopSpacer" Height="0"/>

                <!-- TITLE + ARTIST (visible initially) -->
                <StackPanel x:Name="TitlePanel">
                    <TextBlock Text="{Binding Current.Title}"
                               FontSize="22" FontWeight="SemiBold"
                               Foreground="White" TextWrapping="Wrap" Margin="0,12,0,0"/>
                    <TextBlock Margin="0,4,0,0"
                               Text="{Binding Current.ArtistName, FallbackValue=Unknown Artist}"
                               Foreground="#FFB0B0B0" FontSize="14"/>
                </StackPanel>

                <!-- METADATA GRID -->
                <Grid Margin="0,12,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Display date"
                               Foreground="#FFD0D0D0" FontWeight="SemiBold" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="0" Grid.Column="1"
                               Text="{Binding Current.DisplayDate, TargetNullValue=n/a}"
                               Foreground="#FFD0D0D0"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Type"
                               Foreground="#FFD0D0D0" FontWeight="SemiBold" Margin="0,6,12,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1"
                               Text="{Binding Current.ArtworkType, TargetNullValue=n/a}"
                               Foreground="#FFD0D0D0" Margin="0,6,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Origin"
                               Foreground="#FFD0D0D0" FontWeight="SemiBold" Margin="0,6,12,0"/>
                    <TextBlock Grid.Row="2" Grid.Column="1"
                               Text="{Binding Current.PlaceOfOrigin, TargetNullValue=n/a}"
                               Foreground="#FFD0D0D0" Margin="0,6,0,0" TextWrapping="Wrap"/>
                </Grid>

                <!-- DESCRIPTION: <p>, <em>/<i>, <a href> (clickable) -->
                <FlowDocumentScrollViewer Margin="0,24,0,0"
                                          IsEnabled="True"
                                          PreviewMouseWheel="Description_PreviewMouseWheel"
                                          VerticalScrollBarVisibility="Hidden"
                                          Background="Transparent"
                                          Document="{Binding Current.LongDescription, Converter={StaticResource BasicHtmlToFlowDoc}}"/>
            </StackPanel>
        </ScrollViewer>

        <!-- TOP HOVER BAR (pops down on hover) with Back button -->
        <Grid x:Name="TopHoverRegion"
      Panel.ZIndex="3"
      VerticalAlignment="Top"
      Height="56"
      Background="Transparent">

            <Border x:Name="TopBar"
            Background="{StaticResource HeaderGradient}"
            Height="56"
            VerticalAlignment="Top"
            Opacity="0"
            RenderTransformOrigin="0.5,0">
                <Border.RenderTransform>
                    <TranslateTransform Y="0"/>
                </Border.RenderTransform>

                <!-- Animate self based on hover over the whole region -->
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Opacity" Value="70"/>
                        <Style.Triggers>
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <Binding ElementName="TopHoverRegion" Path="IsMouseOver"/>
                                </DataTrigger.Binding>
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                        Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                        To="0" Duration="0:0:0.18"/>
                                            <DoubleAnimation
                                        Storyboard.TargetProperty="Opacity"
                                        To="1" Duration="0:0:0.12"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                        Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                        To="-56" Duration="0:0:0.18"/>
                                            <DoubleAnimation
                                        Storyboard.TargetProperty="Opacity"
                                        To="0" Duration="0:0:0.10"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Back: fully clickable (no overlay on top) -->
                    <Button Command="{Binding GoBackCommand}"
                    Margin="12,8,8,8"
                    Width="40" Height="40"
                    Background="#2A2A2A"
                    Foreground="White"
                    BorderBrush="{x:Null}"
                    ToolTip="Back"
                    Style="{StaticResource MaterialDesignIconButton}">
                        <materialDesign:PackIcon Kind="ArrowLeftThick" Width="22" Height="22"/>
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <!-- SIDE RAILS (Prev/Next only) -->
        <Grid Panel.ZIndex="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="56"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="56"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT rail -->
            <Grid Grid.Column="0" HorizontalAlignment="Left">
                <Grid x:Name="LeftRegion" Height="280" VerticalAlignment="Center" Background="Transparent">
                    <Grid.Triggers>
                        <EventTrigger RoutedEvent="MouseEnter">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="LeftPanelTT"
                                         Storyboard.TargetProperty="X"
                                         To="0" Duration="0:0:0.18"/>
                                    <DoubleAnimation Storyboard.TargetName="LeftButtons"
                                         Storyboard.TargetProperty="Opacity"
                                         To="1" Duration="0:0:0.12"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                        <EventTrigger RoutedEvent="MouseLeave">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="LeftPanelTT"
                                         Storyboard.TargetProperty="X"
                                         To="-40" Duration="0:0:0.18"/>
                                    <DoubleAnimation Storyboard.TargetName="LeftButtons"
                                         Storyboard.TargetProperty="Opacity"
                                         To="0" Duration="0:0:0.10"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Grid.Triggers>

                    <!-- hit area -->
                    <Border Background="#01000000"/>

                    <!-- buttons -->
                    <StackPanel x:Name="LeftButtons"
                    Orientation="Vertical"
                    VerticalAlignment="Center"
                    Opacity="0"
                    RenderTransformOrigin="0,0.5">
                        <StackPanel.RenderTransform>
                            <TranslateTransform x:Name="LeftPanelTT" X="-40"/>
                        </StackPanel.RenderTransform>

                        <Button Command="{Binding PreviousCommand}"
                    ToolTip="Previous"
                    Width="40" Height="40"
                    Margin="8"
                    Style="{StaticResource MaterialDesignFloatingActionMiniSecondaryDarkButton}">
                            <materialDesign:PackIcon Kind="ChevronLeft"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- RIGHT rail -->
            <Grid Grid.Column="2" HorizontalAlignment="Right" Width="56">
                <Grid x:Name="RightRegion" Height="280" VerticalAlignment="Center" Background="Transparent">
                    <Grid.Triggers>
                        <EventTrigger RoutedEvent="MouseEnter">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="RightPanelTT"
                                         Storyboard.TargetProperty="X"
                                         To="0" Duration="0:0:0.18"/>
                                    <DoubleAnimation Storyboard.TargetName="RightButtons"
                                         Storyboard.TargetProperty="Opacity"
                                         To="1" Duration="0:0:0.12"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                        <EventTrigger RoutedEvent="MouseLeave">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="RightPanelTT"
                                         Storyboard.TargetProperty="X"
                                         To="40" Duration="0:0:0.18"/>
                                    <DoubleAnimation Storyboard.TargetName="RightButtons"
                                         Storyboard.TargetProperty="Opacity"
                                         To="0" Duration="0:0:0.10"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Grid.Triggers>

                    <Border Background="#01000000"/>

                    <StackPanel x:Name="RightButtons"
                    Orientation="Vertical"
                    VerticalAlignment="Center"
                    Opacity="0"
                    RenderTransformOrigin="1,0.5">
                        <StackPanel.RenderTransform>
                            <TranslateTransform x:Name="RightPanelTT" X="40"/>
                        </StackPanel.RenderTransform>

                        <Button Command="{Binding NextCommand}"
                    ToolTip="Next"
                    Width="40" Height="40"
                    Margin="8"
                    Style="{StaticResource MaterialDesignFloatingActionMiniSecondaryDarkButton}">
                            <materialDesign:PackIcon Kind="ChevronRight"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>

        </Grid>
    </Grid>
</UserControl>
